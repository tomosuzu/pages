# テスト駆動開発

## テスト駆動開発とは

テスト駆動開発（TDD：Test Driven Development）は、とても小さな開発プロセスを繰り返す、ソフトウェア開発手法の一つです。

その方法は、

1. まず失敗するテストを書きます （どう失敗するのかを推測しましょう）
2. 次にそれが通るコードを書きます　（綺麗じゃなくていい）
3. 読みやすく、綺麗になるように、リファクタリングします
4. 上記を繰り返します。

といった、とてもシンプルなメソッドです。

## なぜ使うか

なぜ、TDDを行うのでしょうか。

それは速い開発スピードを永久に継続したいからです。

なぜTDDだと速い開発スピードを維持できるのでしょうか。

それは、

1. 速く開発したい
2. 速く開発をするためには、綺麗なコードが必要
3. 綺麗なコードを維持するためには、リファクタリングが必要
4. リファクタリングを好きな時にするためには、コードに対する自信が必要
5. コードに対する自信を持つためには、テストが必要

では、いつテストを書くべきでしょうか。

実装前に書きましょう。

## どうやって行うのか

基本は最初に書いた通り、下記のサイクルを回すことです。

1. まず失敗するテストを書きます （どう失敗するのかを推測しましょう）
2. 次にそれが通るコードを書きます　（綺麗じゃなくていい）
3. 読みやすく、綺麗になるように、リファクタリングします
4. 上記を繰り返します。

この手法における、TDDによるコードに対する自信の扱い方について、

もう少し詳しく説明をします。

慣れている開発であれば、問題ないと思いますが、

慣れていないアプリケーションや慣れていても行き詰まってしまうなど、

不安がある時も多々あると思います。

そういった時には、

TDDのサイクルを小さく回す、つまり、

開発のステップを小さくしてみてください。

例えば、足し算の関数を作る場合、

いきなり、足し算を作るのではなく、

まず、数字を出力する実装をします。

その後、足し算を実装します。

このように、確かなことから着実に進めるように開発のステップを小さくすることで

自信を持てますし、考えるべき対象を絞ることが可能になります。

もし、開発のステップを大きくして、いきなり足し算関数を作って失敗した場合に

出力が悪いのか、足し算の書き方が悪いのかが切り分けるのが大変です。　（このくらい簡単な関数なら大丈夫かもですが）

より複雑な関数になった場合はより大変になります。

また、頭でデバッグするよりも、テストを実行してしまった方が

圧倒的に速く答えを得ることができます。

言葉で説明してみましたが、この「開発のステップを自由自在にする」ことの強力さは、

実際に体験してみないと理解しづらいと思いますので

[テスト駆動開発](https://www.amazon.co.jp/dp/B077D2L69C/ref=dp-kindle-redirect?_encoding=UTF8&btkr=1)
を写経すると実感としてわかると思います。

## よくある質問

### とりあえず、テストがあればいいんだから、後からテスト書けばいいんじゃないの？

個人的にはおすすめしません。

テスト駆動開発は、テスト駆動設計だとも考えられます。

最初に実装を書いてしまうとテストの書きづらいコードになってしまう場合が多いです。

テストがほとんどないシステムでテストを書きやすいように必要な挙動を維持したままリファクタリングしようとした際に、

とても大変な思いをした経験があります。

### QAがいるから、テストいらないよ

テストの大事な要素に速いフィードバックがあります。

全ての実装を作り終えた後にQAに渡し、

根幹の部分を直さないといけないようなバグを見つかる可能性もゼロではありません。

それをQAのタイミングまで待たなくてはならないのは時間がもったいないです。

テストを書かずにQAにテストをお願いし、

直すと他にも影響が出てしまうようなバグでリリースが延期したことがあると聞いたことがあります。

### テスト書く時間があるなら実装する時間に当てたいよ

それでもいいでしょう。緊急で開発しないといけない場合など、

その瞬間の速度が大事であれば、決定次第だと思います。

ただし、ずっとその状態を続けるということであれば、それはお勧めしません。

テストのないコードはほぼ間違いなく、

開発すればするほど、開発速度が落ちていきます。

また、関係のない（と思われる）ところでデグレが生じるなど、

品質も低下すると予想されます。

さらに、テストがないことで気づけず、QAも関係ないと思っていた箇所なので見逃してしまい、

本番環境に出てしまうといった最悪の事態にもなりかねません。

一時的にテストを書かないのは、仕方がないかもしれませんが、

余裕ができた際にテストを追加していくことをお勧めします。

### テストのないアプリケーションをいじることになったんだけどどうすればいいの？

追加開発する必要があるのであれば、

その周辺のコードを優先的にテストを追加していきましょう。

ある程度、自信が持てたら、実際にTDDで実装していきましょう。

必要がない部分に関しては、テストを追加しなくてよいですが、

今後、開発する予定があるのであれば、テストを追加していくとよいでしょう。

## 参考資料

* [テスト駆動開発](https://www.amazon.co.jp/dp/B077D2L69C/ref=dp-kindle-redirect?_encoding=UTF8&btkr=1)
* [TDD: The Bad Parts — Matt Parker](https://www.youtube.com/watch?v=xPL84vvLwXA)
* [Red-Green-Refactor](https://www.jamesshore.com/Blog/Red-Green-Refactor.html)
